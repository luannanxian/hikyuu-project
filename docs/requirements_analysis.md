# Hikyuu日线选股策略需求分析文档

**项目概述**: 基于hikyuu量化框架开发日线数据选股策略

**创建时间**: 2025年9月2日  
**状态**: 需求收集阶段

---

## 1. 选股策略类型分析

### 待讨论问题：
- **技术分析策略偏好**
  - 您倾向于哪种技术分析方法？
  - 是否有特定的技术指标偏好？（如均线系统、MACD、RSI、布林带等）
  - 对趋势跟踪vs均值回归策略的偏好？

- **基本面分析需求**
  - 是否需要结合基本面数据？
  - 财务指标的重要性如何？
  - 是否考虑估值指标？

- **量化因子选择**
  - 动量因子、价值因子、成长因子的权重考虑
  - 是否需要自定义因子？
  - 因子有效性验证需求

### 用户反馈：
```
✅ 已确定：选择因子挖掘方向
✅ 技术类因子 + 市场结构因子相结合
✅ 因子计算周期：5日、20日、60日
✅ 因子组合方式：构建技术-结构的交互因子
✅ 因子更新频率：日频更新
✅ 因子筛选标准：通过因子选股回测，选取收益最大且回撤≤5%的因子组合

具体因子类别：
- 技术类因子：动量因子、波动率因子、技术形态因子
- 市场结构因子：流动性因子、规模因子、市场微观结构因子
- 交互因子：动量×流动性、突破×资金流入、波动率×规模、技术强度×相对表现
```

---

## 2. 选股目标规格

### 待讨论问题：
- **选股数量定义**
  - 希望选出多少只股票？（Top 10/20/50）
  - 是否需要分层选股？（如按市值、行业分层）

- **更新频率设计**
  - 选股更新频率：每日、每周、每月？
  - 持仓调整的触发条件

- **目标市场范围**
  - A股全市场还是特定板块？
  - 是否排除ST股票、新股等特殊情况？
  - 市值范围限制？

- **筛选条件设置**
  - 流动性要求（成交量、换手率）
  - 价格区间限制
  - 其他基础筛选条件

### 用户反馈：
```
✅ 已确定：
- 选股数量：Top 10只股票
- 股票池范围：市值<60亿的A股股票
- 排除条件：排除ST股票、新股、停牌股
- 调仓机制：达到-5%止损线卖出，否则一直持有
- 更新频率：日频更新选股结果
```

---

## 3. 策略复杂度规划

### 待讨论问题：
- **单策略vs多策略组合**
  - 使用单一选股策略还是多策略综合？
  - 如果是多策略，如何分配权重？
  - 策略之间的相关性考虑

- **风险控制机制**
  - 是否需要风险控制模块？
  - 止损机制的设计需求
  - 集中度控制（行业、个股）

- **资金管理策略**
  - 等权重分配还是优化权重？
  - 是否考虑交易成本？
  - 资金使用效率优化

- **回测验证需求**
  - 回测时间长度要求
  - 需要哪些绩效指标？
  - 基准对比需求

### 用户反馈：
```
✅ 已确定：
- 风险控制机制：-5%止损
- 回测验证需求：1-2年历史数据
- 基准对比：沪深300
- 资金管理：等权重分配给选出的10只股票
- 策略类型：单一的交互因子选股策略
```

---

## 4. 技术实现方案

### 待讨论问题：
- **代码架构设计**
  - 独立Python脚本、类库还是命令行工具？
  - 模块化程度要求
  - 代码复用性考虑

- **数据获取方式**
  - 直接使用hikyuu API还是结合数据库查询？
  - 数据缓存策略
  - 实时数据vs历史数据需求

- **hikyuu框架使用**
  - 主要使用hikyuu的哪些功能模块？
  - 是否需要自定义指标？
  - 与hikyuu现有功能的集成度

- **输出格式定义**
  - 控制台输出、文件输出还是可视化？
  - 结果数据的详细程度
  - 是否需要报告生成功能？

### 用户反馈：
```
✅ 已确定：
- 代码架构：基于hikyuu的选股策略，通过hikyuu进行回测
- 配置管理：需要配置文件来调整因子权重和筛选参数
- 权重优化：因子权重需要通过反复测试确定
- 数据获取：主要使用hikyuu API，结合项目中的MySQL MCP优化
- 模块化设计：支持因子权重调整和参数优化
```

---

## 5. 业务场景适配

### 待讨论问题：
- **应用场景定义**
  - 个人投资决策、研究分析还是其他用途？
  - 使用者的技术背景和经验水平
  - 与现有投资流程的集成需求

- **用户使用流程**
  - 典型的使用场景和流程
  - 参数调整的便利性需求
  - 结果解读和应用方式

- **性能要求**
  - 运行时间容忍度
  - 数据处理规模
  - 系统资源消耗限制

- **扩展性考虑**
  - 未来功能扩展预期
  - 策略迭代和优化需求
  - 多市场支持可能性

### 用户反馈：
```
待填写...
```

---

## 6. 具体实现细节

### 待讨论问题：
- **核心算法逻辑**
  - 选股评分机制设计
  - 多因子合成方法
  - 异常值处理策略

- **参数配置管理**
  - 参数调整的灵活性需求
  - 配置文件格式偏好
  - 参数优化功能需求

- **错误处理机制**
  - 数据缺失处理方案
  - 异常情况处理策略
  - 容错性要求

- **日志监控体系**
  - 运行日志详细程度
  - 性能监控需求
  - 调试信息记录

### 用户反馈：
```
待填写...
```

---

## 7. 现有资源分析

### hikyuu框架能力评估
基于项目中的文档分析，hikyuu框架提供：

- **数据管理**: 完整的A股历史数据支持
- **技术指标**: 100+内置技术指标
- **交易系统**: 完整的回测和交易管理
- **数据库支持**: MySQL/HDF5等多种数据源
- **Python集成**: 完整的Python API

### 可利用的项目资源
- `docs/hikyuu-framework-analysis.md` - 框架深度分析
- `docs/hikyuu-python-api-reference.md` - API完整参考
- `docs/hikyuu-database-structure-analysis.md` - 数据库结构
- `docs/example-code/hikyuu_programming_examples.py` - 编程示例
- MySQL MCP集成 - 数据库查询优化

---

## 下一步行动计划

1. **需求澄清阶段**：逐一讨论上述6个方面的具体需求
2. **方案设计阶段**：基于需求设计技术方案和架构
3. **原型开发阶段**：实现核心功能原型
4. **测试验证阶段**：回测验证和性能优化
5. **文档完善阶段**：使用说明和部署文档

---

## 8. 需求总结与技术方案

### 核心需求总结
基于以上讨论，确定的核心需求为：

**选股策略**：
- 技术类因子 + 市场结构因子的交互因子挖掘
- 目标：市值<60亿A股，排除ST/新股/停牌，选出Top10
- 更新：日频更新选股结果
- 风控：-5%止损，否则一直持有

**因子体系**：
- 计算周期：5日、20日、60日多周期
- 因子类型：动量×流动性、突破×资金流入、波动率×规模、技术强度×相对表现
- 权重优化：通过回测反复测试确定最优权重组合

**回测验证**：
- 历史数据：1-2年
- 基准对比：沪深300
- 筛选标准：收益最大且回撤≤5%

### 具体交互因子设计方案

#### 1. 动量×流动性交互因子
```python
# 价格动量与成交量配合
momentum_liquidity_5d = price_momentum_5d × (volume_5d / volume_20d)
momentum_liquidity_20d = price_momentum_20d × (turnover_20d / turnover_60d)

# 技术突破与换手率提升
breakout_liquidity = price_breakout_signal × turnover_surge_ratio
```

#### 2. 突破×资金流入交互因子
```python
# 价格突破与成交额放大
breakout_money_flow = price_breakout × (amount_5d / amount_20d)

# 技术指标突破与资金流入强度
rsi_breakout_flow = rsi_oversold_recovery × money_flow_intensity
macd_breakout_flow = macd_golden_cross × volume_price_matching
```

#### 3. 波动率×规模交互因子
```python
# 波动率下降与市值相对位置
volatility_size = volatility_decline_20d × market_cap_percentile

# ATR标准化与流通市值
atr_size = normalized_atr_60d × (1 / log(float_market_cap))

# 波动率稳定性与规模因子
volatility_stability = volatility_regime_change × size_factor
```

#### 4. 技术强度×相对表现交互因子
```python
# 技术指标强度与相对强弱
technical_relative = (rsi_momentum + macd_strength) × relative_strength_60d

# 均线排列与行业相对表现
ma_arrangement_relative = ma_bullish_arrangement × industry_relative_performance

# 趋势强度与市场地位
trend_position = trend_slope_20d × (market_cap_rank / total_stocks)
```

### 系统架构设计

#### 模块结构
```
small_cap_factor_selection/
├── core/
│   ├── factor_calculator.py      # 因子计算核心
│   ├── interaction_builder.py    # 交互因子构建
│   ├── stock_screener.py         # 股票池筛选
│   └── portfolio_optimizer.py    # 组合优化
├── factors/
│   ├── technical_factors.py      # 技术类因子
│   ├── structure_factors.py      # 市场结构因子
│   └── interaction_factors.py    # 交互因子定义
├── backtest/
│   ├── hikyuu_backtester.py      # 基于hikyuu的回测
│   ├── performance_analyzer.py   # 绩效分析
│   └── weight_optimizer.py       # 权重优化
├── config/
│   ├── factor_weights.json       # 因子权重配置
│   ├── stock_filter.json         # 股票筛选配置
│   └── backtest_params.json      # 回测参数配置
└── main.py                       # 主程序入口
```

#### 实现优先级
**Phase 1: 基础框架**
- 股票池筛选（市值<60亿，排除ST等）
- 基础因子计算（5/20/60日技术和结构因子）
- 简单交互因子构建

**Phase 2: 核心功能**
- 完整交互因子体系
- Top10选股算法
- 基于hikyuu的基础回测

**Phase 3: 优化和验证**
- 因子权重优化算法
- 完整的绩效分析体系
- 参数配置系统

**Phase 4: 高级功能**
- 滚动窗口回测
- 因子有效性验证
- 可视化报告系统

---

**备注**: 本文档记录了完整的需求分析过程，将作为后续开发的技术规范。需求已确定，可以开始具体实现。
