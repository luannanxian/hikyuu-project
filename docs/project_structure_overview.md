# Hikyuué‡åŒ–äº¤æ˜“ç­–ç•¥é¡¹ç›®ç»“æ„æ¦‚è§ˆ

## é¡¹ç›®æ€»ä½“ç»“æ„

```
hikyuu-project/
â”œâ”€â”€ docs/                          # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ hikyuu-api-usage-guide.md       # Hikyuu APIä½¿ç”¨æŒ‡å—
â”‚   â”œâ”€â”€ hikyuu-database-structure-analysis.md  # æ•°æ®åº“ç»“æ„åˆ†æ
â”‚   â”œâ”€â”€ hikyuu-framework-analysis.md     # æ¡†æ¶åˆ†æ
â”‚   â”œâ”€â”€ hikyuu-python-api-reference.md  # Python APIå‚è€ƒ
â”‚   â”œâ”€â”€ mysql-server.md                 # MySQLæœåŠ¡å™¨é…ç½®
â”‚   â””â”€â”€ example-code/
â”‚       â””â”€â”€ hikyuu_programming_examples.py  # ç¼–ç¨‹ç¤ºä¾‹
â”œâ”€â”€ strategy_implementation/        # ç­–ç•¥å®ç°æ¨¡å— âœ… å·²å®Œæˆ
â”‚   â”œâ”€â”€ __init__.py                     # æ¨¡å—åˆå§‹åŒ–
â”‚   â”œâ”€â”€ factor_calculation.py           # å¤šå› å­è®¡ç®—
â”‚   â”œâ”€â”€ scoring_system.py              # è¯„åˆ†ç³»ç»Ÿ
â”‚   â”œâ”€â”€ stock_screening.py             # è‚¡ç¥¨ç­›é€‰
â”‚   â””â”€â”€ main_strategy.py               # ä¸»ç­–ç•¥ç±»
â”œâ”€â”€ backtest_system/                # å›æµ‹ç³»ç»Ÿ ğŸš§ å¾…å®ç°
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ selector.py                     # ç­–ç•¥é€‰æ‹©å™¨
â”‚   â”œâ”€â”€ portfolio.py                   # æŠ•èµ„ç»„åˆç®¡ç†
â”‚   â”œâ”€â”€ performance.py                 # ç»©æ•ˆåˆ†æ
â”‚   â”œâ”€â”€ report.py                      # æŠ¥å‘Šç”Ÿæˆ
â”‚   â””â”€â”€ visualization.py              # å¯è§†åŒ–
â”œâ”€â”€ tests/                         # æµ‹è¯•å’Œè°ƒè¯• âœ… å·²æœ‰éƒ¨åˆ†
â”‚   â”œâ”€â”€ debug_factors.py               # å› å­è°ƒè¯•
â”‚   â”œâ”€â”€ debug_scoring.py               # è¯„åˆ†è°ƒè¯•
â”‚   â”œâ”€â”€ test_market_cap.py             # å¸‚å€¼æµ‹è¯•
â”‚   â””â”€â”€ test_index_exclusion.py        # æŒ‡æ•°æ’é™¤æµ‹è¯•
â”œâ”€â”€ config/                        # é…ç½®æ–‡ä»¶ ğŸš§ å¾…åˆ›å»º
â”‚   â”œâ”€â”€ strategy_config.py             # ç­–ç•¥é…ç½®
â”‚   â””â”€â”€ backtest_config.py             # å›æµ‹é…ç½®
â”œâ”€â”€ data/                          # æ•°æ®ç›®å½• ğŸš§ å¾…åˆ›å»º
â”‚   â”œâ”€â”€ output/                        # è¾“å‡ºç»“æœ
â”‚   â””â”€â”€ temp/                          # ä¸´æ—¶æ–‡ä»¶
â”œâ”€â”€ requirements_analysis.md        # éœ€æ±‚åˆ†æ âœ… å·²å®Œæˆ
â”œâ”€â”€ strategy_specification.md       # ç­–ç•¥è§„æ ¼è¯´æ˜ âœ… å·²å®Œæˆ
â”œâ”€â”€ backtest_system_design.md       # å›æµ‹ç³»ç»Ÿè®¾è®¡ âœ… å·²å®Œæˆ
â”œâ”€â”€ run_strategy.py                 # ç­–ç•¥è¿è¡Œå…¥å£ âœ… å·²å®Œæˆ
â””â”€â”€ README.md                       # é¡¹ç›®è¯´æ˜
```

## å½“å‰å®ç°çŠ¶æ€

### âœ… å·²å®Œæˆçš„æ ¸å¿ƒç­–ç•¥æ¨¡å—
1. **å¤šå› å­è®¡ç®—ç³»ç»Ÿ** (`strategy_implementation/factor_calculation.py`)
   - æŠ€æœ¯å› å­ï¼šRSIã€MACDã€MAåç¦»åº¦ã€ATRã€å¸ƒæ—å¸¦
   - ç»“æ„å› å­ï¼šæˆäº¤é‡ã€æ¢æ‰‹ç‡ã€èµ„é‡‘æµ
   - äº¤äº’å› å­ï¼šåŠ¨é‡Ã—æµåŠ¨æ€§ã€çªç ´Ã—èµ„é‡‘æµç­‰
   - çŠ¶æ€ï¼šå®Œå…¨å®ç°ï¼Œç»è¿‡æµ‹è¯•éªŒè¯

2. **è¯„åˆ†ç³»ç»Ÿ** (`strategy_implementation/scoring_system.py`)
   - Z-scoreæ ‡å‡†åŒ–
   - æ¨ªæˆªé¢å› å­æ’åºè¯„åˆ†
   - ç»¼åˆå› å­å¾—åˆ†è®¡ç®—
   - çŠ¶æ€ï¼šå®Œå…¨å®ç°ï¼Œä¿®å¤äº†åºåˆ—åŒ–å’Œè¯„åˆ†bugs

3. **è‚¡ç¥¨ç­›é€‰ç³»ç»Ÿ** (`strategy_implementation/stock_screening.py`)
   - å°ç›˜è‚¡ç­›é€‰ï¼ˆå¸‚å€¼<600äº¿ï¼‰
   - æŒ‡æ•°æˆåˆ†è‚¡æ’é™¤
   - äº¤æ˜“çŠ¶æ€è¿‡æ»¤
   - çŠ¶æ€ï¼šå®Œå…¨å®ç°ï¼Œæ­£ç¡®ä½¿ç”¨ZONGGUBENæŒ‡æ ‡

4. **ä¸»ç­–ç•¥ç±»** (`strategy_implementation/main_strategy.py`)
   - ç­–ç•¥æµç¨‹ç¼–æ’
   - ä¸­æ–‡å› å­åç§°æœ¬åœ°åŒ–
   - JSONåºåˆ—åŒ–è¾“å‡º
   - çŠ¶æ€ï¼šå®Œå…¨å®ç°ï¼Œå¹³å‡å¾—åˆ†84.75ï¼Œè¿è¡Œæ­£å¸¸

### ğŸš§ å¾…å®ç°çš„å›æµ‹ç³»ç»Ÿ
æ ¹æ® `backtest_system_design.md` è®¾è®¡æ–‡æ¡£ï¼Œéœ€è¦å®ç°ï¼š

1. **ç­–ç•¥é€‰æ‹©å™¨** (`backtest_system/selector.py`)
   - ç»§æ‰¿hikyuu.SelectorBase
   - å®ç°_calculate()å’Œget_selected()æ–¹æ³•
   - é›†æˆç°æœ‰ç­–ç•¥é€»è¾‘

2. **æŠ•èµ„ç»„åˆç®¡ç†** (`backtest_system/portfolio.py`)
   - Portfolioé…ç½®å’Œç®¡ç†
   - èµ„é‡‘åˆ†é…ç­–ç•¥
   - ä»“ä½æ§åˆ¶

3. **ç»©æ•ˆåˆ†æ** (`backtest_system/performance.py`)
   - æ”¶ç›Šç‡è®¡ç®—
   - é£é™©æŒ‡æ ‡ï¼ˆå¤æ™®æ¯”ç‡ã€æœ€å¤§å›æ’¤ç­‰ï¼‰
   - åŸºå‡†æ¯”è¾ƒ

4. **æŠ¥å‘Šç”Ÿæˆ** (`backtest_system/report.py`)
   - ä¸­æ–‡å›æµ‹æŠ¥å‘Š
   - ç»©æ•ˆç»Ÿè®¡è¡¨æ ¼
   - äº¤æ˜“æ˜ç»†

5. **å¯è§†åŒ–** (`backtest_system/visualization.py`)
   - å‡€å€¼æ›²çº¿å›¾
   - å›æ’¤å›¾è¡¨
   - å› å­åˆ†æå›¾

## æŠ€æœ¯æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Hikyuu é‡åŒ–äº¤æ˜“ç³»ç»Ÿ                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      å›æµ‹ç³»ç»Ÿå±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   é€‰æ‹©å™¨     â”‚  â”‚  æŠ•èµ„ç»„åˆ    â”‚  â”‚   ç»©æ•ˆåˆ†æ   â”‚         â”‚
â”‚  â”‚  Selector   â”‚  â”‚  Portfolio  â”‚  â”‚ Performance â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      ç­–ç•¥å®ç°å±‚ âœ…                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   å› å­è®¡ç®—   â”‚  â”‚   è¯„åˆ†ç³»ç»Ÿ   â”‚  â”‚   è‚¡ç¥¨ç­›é€‰   â”‚         â”‚
â”‚  â”‚   Factors   â”‚  â”‚   Scoring   â”‚  â”‚  Screening  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      Hikyuu æ¡†æ¶å±‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚    æ•°æ®æº    â”‚  â”‚    æŒ‡æ ‡åº“    â”‚  â”‚   äº¤æ˜“ç®¡ç†   â”‚         â”‚
â”‚  â”‚ DataSource  â”‚  â”‚ Indicators  â”‚  â”‚TradeManager â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## é›†æˆè¦ç‚¹

### 1. æ•°æ®æµå‘
```
åŸå§‹æ•°æ® â†’ å› å­è®¡ç®— â†’ è¯„åˆ†æ’åº â†’ è‚¡ç¥¨ç­›é€‰ â†’ ç­–ç•¥é€‰æ‹©å™¨ â†’ æŠ•èµ„ç»„åˆ â†’ ç»©æ•ˆåˆ†æ
```

### 2. å…³é”®æ¥å£
- **ç­–ç•¥åˆ°å›æµ‹**ï¼š`main_strategy.py` â†’ `selector.py`
- **é€‰æ‹©å™¨åˆ°ç»„åˆ**ï¼š`SelectorBase.get_selected()` â†’ `Portfolio`
- **ç»„åˆåˆ°åˆ†æ**ï¼š`Portfolio.performance` â†’ `performance.py`

### 3. é…ç½®ç®¡ç†
- ç­–ç•¥å‚æ•°é…ç½®ï¼ˆå› å­æƒé‡ã€ç­›é€‰æ¡ä»¶ï¼‰
- å›æµ‹å‚æ•°é…ç½®ï¼ˆèµ·æ­¢æ—¶é—´ã€èµ„é‡‘è§„æ¨¡ã€äº¤æ˜“è´¹ç”¨ï¼‰

## ä¸‹ä¸€æ­¥å®æ–½è®¡åˆ’

1. **åˆ›å»ºç›®å½•ç»“æ„**
   ```bash
   mkdir -p backtest_system config data/output data/temp
   ```

2. **æŒ‰ä¼˜å…ˆçº§å®ç°å›æµ‹ç»„ä»¶**
   - Phase 1: `selector.py` - ç­–ç•¥é€‰æ‹©å™¨ï¼ˆæ ¸å¿ƒï¼‰
   - Phase 2: `portfolio.py` - æŠ•èµ„ç»„åˆç®¡ç†
   - Phase 3: `performance.py` - ç»©æ•ˆåˆ†æ
   - Phase 4: `report.py` - æŠ¥å‘Šç”Ÿæˆ
   - Phase 5: `visualization.py` - å¯è§†åŒ–

3. **åˆ›å»ºç»Ÿä¸€å…¥å£**
   - `run_backtest.py` - å›æµ‹è¿è¡Œè„šæœ¬
   - é›†æˆç­–ç•¥å’Œå›æµ‹æµç¨‹

## ä¼˜åŠ¿ç‰¹ç‚¹

âœ… **å·²éªŒè¯çš„ç­–ç•¥æ ¸å¿ƒ**ï¼šå¤šå› å­æ¨¡å‹å®Œæ•´å®ç°å¹¶æµ‹è¯•é€šè¿‡
âœ… **æ ‡å‡†åŒ–æ¶æ„**ï¼šéµå¾ªhikyuuæ¡†æ¶è®¾è®¡æ¨¡å¼
âœ… **ä¸­æ–‡æœ¬åœ°åŒ–**ï¼šå› å­åç§°å’ŒæŠ¥å‘Šå®Œå…¨ä¸­æ–‡åŒ–
âœ… **æ¨¡å—åŒ–è®¾è®¡**ï¼šå„ç»„ä»¶ç‹¬ç«‹ï¼Œä¾¿äºæµ‹è¯•å’Œç»´æŠ¤
âœ… **å®Œæ•´è®¾è®¡æ–‡æ¡£**ï¼šè¯¦ç»†çš„å›æµ‹ç³»ç»Ÿè®¾è®¡è§„æ ¼

## ç¡®è®¤äº‹é¡¹

è¯·ç¡®è®¤ä»¥ä¸‹å‡ ç‚¹ï¼š
1. é¡¹ç›®ç»“æ„æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Ÿ
2. ç­–ç•¥å®ç°æ¨¡å—çš„å®Œæˆåº¦æ˜¯å¦æ»¡æ„ï¼Ÿ
3. å›æµ‹ç³»ç»Ÿçš„è®¾è®¡æ˜¯å¦åˆç†ï¼Ÿ
4. æ˜¯å¦éœ€è¦è°ƒæ•´ä»»ä½•ç»„ä»¶çš„è®¾è®¡ï¼Ÿ

ç¡®è®¤åå³å¯å¼€å§‹å›æµ‹ç³»ç»Ÿçš„å…·ä½“å®ç°ã€‚
