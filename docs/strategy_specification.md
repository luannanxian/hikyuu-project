# 小市值交互因子选股策略技术规格书

## 1. 策略概述

### 目标
开发基于hikyuu框架的小市值A股选股策略，通过技术因子、市场结构因子和交互因子的多维度分析，每日选出TOP 10股票。

### 核心创新点
- **交互因子设计**：四大交互因子组合，挖掘因子间的非线性关系
- **小市值聚焦**：专注市值<60亿的小市值股票，利用效率差异
- **多周期融合**：5/20/60日多周期验证，提高信号可靠性

## 2. 选股标准

### 股票池筛选
- **市场范围**：A股市场（上海、深圳、北京交易所）
- **市值限制**：总市值 < 60亿人民币
- **排除条件**：
  - ST、*ST股票
  - 新上市股票（上市不足60个交易日）
  - 停牌股票
  - 数据不完整股票

### 选股数量
- 每日选出10只股票
- 等权重配置

## 3. 因子体系设计

### 3.1 技术因子（权重30%）
- **移动平均**：MA5、MA10、MA20、MA60
- **MACD指标**：DIF、DEA、柱状图
- **相对强弱指数**：RSI(14)
- **平均真实波幅**：ATR(14)
- **布林带**：BOLL(20,2)

### 3.2 市场结构因子（权重25%）
- **流动性指标**：
  - 成交量变化率
  - 换手率及其历史分位数
  - 成交额占比
- **资金流向**：
  - 价量配合度
  - 资金净流入强度
- **市值特征**：
  - 市值排名
  - 市值相对变化

### 3.3 交互因子（权重45%）

#### 动量×流动性（交互因子权重30%）
- **动量强度**：MA5/MA20斜率 + MACD柱状图变化率
- **流动性指标**：成交量变化率 + 换手率相对历史均值
- **交互计算**：动量强度 × log(1 + 流动性指标)

#### 突破×资金流（交互因子权重35%）
- **突破信号**：价格突破布林带上轨 + 成交量放大倍数
- **资金流指标**：(收盘价-开盘价)/开盘价 × 成交额变化率
- **交互计算**：突破强度 × 资金流强度的加权平均

#### 波动×市值（交互因子权重20%）
- **波动率**：ATR(14)/收盘价 + 高低价差异系数
- **市值权重**：market_cap的倒数排名（小市值权重更高）
- **交互计算**：适度波动率 × 小市值权重

#### 技术强度×相对表现（交互因子权重15%）
- **技术强度**：RSI位置 + MACD金叉强度 + 均线排列得分
- **相对表现**：个股涨幅 - 沪深300涨幅（多周期）
- **交互计算**：技术强度 × (1 + 相对表现系数)

## 4. 多周期分析

### 时间周期
- **5日周期**：短期动量和流动性特征
- **20日周期**：中期趋势确认
- **60日周期**：长期方向验证

### 周期权重（固定权重版本）
- 5日周期：50%
- 20日周期：35%
- 60日周期：15%

## 5. 评分机制

### 标准化处理
- **横截面标准化**：每日对所有候选股票进行Z-score标准化
- **排名转换**：转换为0-100的排名分数
- **异常值处理**：超过3个标准差的值进行截断

### 综合评分公式
```
股票总分 = 技术因子权重 × 技术因子得分
        + 市场结构因子权重 × 市场结构因子得分  
        + 交互因子权重 × 交互因子得分

其中：
因子得分 = Σ(周期权重 × 该周期的因子值)
最终排名 = 按总分降序排列，选取TOP 10
```

## 6. 风险控制

### 止损机制
- **固定止损**：单只股票-5%严格止损
- **执行方式**：收盘价跌破买入价95%时次日开盘卖出

### 组合风险控制
- **行业分散**：单一行业持股不超过40%
- **个股权重**：等权重配置，单股权重10%

## 7. 回测验证

### 回测设置
- **时间范围**：2022年1月1日 - 2024年12月31日（2年期）
- **基准指数**：沪深300指数
- **调仓频率**：每日调仓
- **交易成本**：0.3%综合费率

### 绩效指标
- **收益指标**：总收益率、年化收益率
- **风险指标**：最大回撤、年化波动率、夏普比率
- **交易统计**：胜率、平均持仓期、年换手率

## 8. 技术实现

### 核心原则
**严格基于hikyuu框架**：所有开发工作完全基于hikyuu量化交易框架进行，不自己设计任何量化框架组件。

### 开发环境
- **框架**：hikyuu量化交易框架（完全依赖）
- **语言**：Python
- **数据源**：hikyuu内置数据管理系统
- **验证工具**：MySQL MCP、DeepWiki MCP

### hikyuu框架组件使用

#### 数据管理组件
- **StockManager**：股票数据管理，股票筛选
- **Stock对象**：个股数据访问，K线获取
- **Query对象**：数据查询条件设置

#### 技术指标组件
- **内置指标**：MA、MACD、RSI、ATR、BOLL等
- **指标计算**：使用hikyuu的Indicator体系
- **上下文设置**：`indicator.set_context(stock, query)`

#### 交易系统组件
- **TradeManager**：交易管理和资金管理
- **System组件**：SYS_Simple等交易系统
- **信号指示器**：SG_Cross、SG_Bool等
- **资金管理**：MM_FixedPercent等
- **风险控制**：ST_FixedPercent等

#### 回测验证组件
- **Portfolio**：投资组合管理PF_Simple
- **选择器**：SE_Fixed等股票选择器
- **绩效分析**：Performance类和绩效报告

### 实现架构（基于hikyuu组件）
```
strategy_implementation/
├── factor_calculation.py         # 基于hikyuu指标的因子计算
├── stock_screening.py            # 基于StockManager的股票筛选
├── scoring_system.py             # 因子评分和排名系统
├── portfolio_strategy.py         # 基于PF_Simple的投资组合
├── backtest_runner.py            # 基于hikyuu回测框架的验证
└── main_strategy.py              # 主策略整合（使用hikyuu组件）
```

### 开发规范
1. **框架依赖**：所有功能完全基于hikyuu现有组件实现
2. **API使用**：严格按照hikyuu API文档进行调用
3. **数据访问**：完全通过hikyuu框架API，绝不直接SQL查询
4. **指标计算**：使用hikyuu内置指标，必要时组合现有指标
5. **交易系统**：基于hikyuu的System、Portfolio等组件构建
6. **回测验证**：使用hikyuu的回测引擎和绩效分析工具
7. **问题解决**：使用DeepWiki MCP查询hikyuu框架使用问题
8. **结果验证**：使用MySQL MCP验证选股结果正确性
9. **文档驱动**：严格基于docs中的hikyuu使用示例和API参考

## 9. 实施计划

### 第一阶段：基础实现
1. 实现因子计算模块
2. 构建选股引擎
3. 完成基础回测功能

### 第二阶段：验证优化
1. 历史数据回测验证
2. 结果一致性检查
3. 性能优化调整

### 第三阶段：扩展功能（后续）
1. 动态权重优化
2. 市场状态识别
3. 实时选股系统

## 10. 预期成果

### 策略表现目标
- **年化收益率**：目标超越沪深300指数15%以上
- **最大回撤**：控制在25%以内
- **夏普比率**：目标达到1.2以上
- **胜率**：单股胜率55%以上

### 系统功能
- 自动化选股：每日自动生成TOP 10股票列表
- 风险控制：实时监控止损信号
- 绩效跟踪：完整的业绩归因分析
- 数据验证：多重验证确保结果可靠性

---

**创建时间**：2025年9月4日  
**策略版本**：v1.0（固定权重版本）  
**下一步**：开始模块化代码实现
